<!DOCTYPE html>
<html>
<head>
	<!-- TODO: endgame() -->
	<title>Baldur's Gate</title>
	<script type="text/javascript">
		var deck1 = ['lightning', 'wolf', 'eldest','whip'], 
			deck2 = ['krydle', 'time', 'squeaky', 'twice', 'eyesboo', 'wrap'],
			deck3 = ['banishing', 'fluffy', 'cure', 'justice', 'smite', 'words'];
		var hand = [], discard = [], hand2 = [], discard2 = [], decks = [2, 3]; // decks for choosing and drawing b/w
		var myturn = true, hp = 10, playsLeft = 1, blocks = 0,hp2 = 10, playsLeft2 = 0, blocks2 = 0;

		function init() { document.getElementById('drawer').onclick = end;
			document.getElementById('drawer').style.display = 'none';
			document.getElementById('drawer').innerHTML = 'End Turn';
			for (var i = 0; i < 2; i++) {
				// deck1.push('silvanus');
				// deck1.push('balance');
				// deck1.push('nature');
				// deck1.push('primal');
				// deck1.push('bearnard');
				// deck1.push('poochie');
				// deck1.push('rush');
				// deck1.push('fox');
				// deck1.push('whip');
				// deck1.push('lightning');
				// deck1.push('bear');
				// deck1.push('wolf');
				deck2.push('squeaky');
				deck2.push('waits');
				deck2.push('twice');
				deck2.push('eyesboo');
				// deck2.push('rodent');
				// deck2.push('boowedo');
				// deck2.push('mount');
				// deck2.push('nerys');
				// deck2.push('scouting');
				// deck2.push('frenemies');
				// deck2.push('swapportunity');
				deck3.push('inspiration');
				// deck3.push('shield');
				deck3.push('smite');
				deck3.push('words');
				// deck3.push('fingerwag');
				deck3.push('justice');
				// deck3.push('morejust');
				// deck3.push('morejust');
				// deck3.push('mostjust');
				// deck3.push('charisma');
				// deck3.push('spinparry');
			}

			deck1 = shuffle(deck1);
			deck2 = shuffle(deck2);
			deck3 = shuffle(deck3);

			for (var i = 0; i < 4; i++) {// Drawing extra for first turn
				draw(decks[0]);
				hand2.push(deck3.pop());
			}
		}

		function draw(deckNo) { // Check deck.length, if empty deck = shuffle(discard); discard = 0
			switch(deckNo){
				case 1: if(!deck1.length){ alert('Deck '+deckNo+ ' empty. Shuffling discard pile.');
											if(myturn) deck1 = shuffle(discard); 
											else deck1 = shuffle(discard2);  }
						hand.push(deck1.pop()); break;
				case 2: if(!deck2.length){ alert('Deck '+deckNo+ ' empty. Shuffling discard pile.');
											if(myturn) deck2 = shuffle(discard); 
											else deck2 = shuffle(discard2);  }
						hand.push(deck2.pop()); break;
				case 3: if(!deck3.length){ alert('Deck '+deckNo+ ' empty. Shuffling discard pile.');
											if(myturn) deck3 = shuffle(discard); 
											else deck3 = shuffle(discard2);  }
						hand.push(deck3.pop()); break;
				default: alert('error');
			}

			display(); 
		}

		function play(card) { playsLeft--; document.getElementById('drawer').style.display = 'initial';
			let cardName = card.slice(card.indexOf('images/') + 7, card.indexOf('.jpg'));
			console.log('Played '+cardName.toUpperCase());
			switch(cardName){
				case 'words': heal(1);
				case 'twice': attack(2); break;
				case 'smite': heal(1);
				case 'eyesboo': attack(3); break;
				case 'cure': heal(1); draw(3);draw(3); break;
				case 'waits':  extraPlay(2); break;                                       
				case 'justice': attack(1); extraPlay(1); break;
				case 'time': attack(2); extraPlay(1); break;
				case 'squeaky': attack(1); extraPlay(1); break;
				case 'wrap': heal(1); draw(2); break;
				case 'fluffy': block(2); break;
				case 'krydle': block(3); break;
				case 'banishing': blocks = 0; blocks2 = 0; extraPlay(1); break;
				case 'inspiration': chooseFromDiscard(); heal(2); break;    
				default: alert('Card not yet implemented..');
			}
			hand.splice(hand.indexOf(cardName), 1);
			if(myturn) discard.push(cardName);
			else discard2.push(cardName); 
			display();
		}

		function attack(arg){ let atk = arg;
			if(blocks2 > atk){
					blocks2-=atk; return;  
			}
			else {atk -= blocks2; blocks2 = 0;}
			if(hp2-atk > 0) hp2 -= atk;  
			else hp2 = 0;
		}  

		function extraPlay(argument) {
			playsLeft += argument;
		}

		function heal(arg){
			if( (hp+arg) <= 10) hp+=arg;
			else hp = 10;   
		}

		function block(argument) {
			blocks += argument;
		}

		function chooseFromDiscard() { let choice = 0;
			if(myturn) while(!discard.includes(choice)) choice = prompt("Choose from your discard: "+discard); 
			else while(!discard2.includes(choice)) choice = prompt("Choose from your discard: "+discard2);

			hand.push(choice);
			display();
		}

		function display() { document.getElementById('hand').innerHTML = '';
			for (var i = 0; i < hand.length; i++) {
				let newcard = document.createElement('img');
				newcard.src = 'images/' + hand[i] + '.jpg';
				newcard.width = 200;
				if(playsLeft) newcard.style.cursor = 'pointer';
				newcard.style.marginRight = '40px';
				if(playsLeft) newcard.onclick = function() {play(this.src)};
				document.getElementById('hand').append(newcard);
			}

			document.getElementById('stats').innerHTML = 'HP: '+hp+'<br>Plays: '+playsLeft+'<br>Blocks: '+blocks;
			document.getElementById('stats2').innerHTML = 'OPPONENT' +'<hr>HP: '+hp2+'<br>Plays: '+playsLeft2+'<br>Blocks: '+blocks2;
		}
		// alert(deck1.length +' ' + deck2.length);
		function shuffle(list) {
			var newOrder = [];
			var len = list.length;
			for (var i = 0; i < len; i++) { var r = Math.floor(Math.random()*list.length);
				newOrder.push(list[r]);
				list.splice(r, 1);
			}
			return newOrder;
		}

		function end() { if(playsLeft) {alert('You cannot end turn with plays left.');
				// Draw if no cards but plays left
				if(!hand.length){ alert('No cards in hand. Drawing 2 cards..');
					if(myturn) { draw(decks[0]); draw(decks[0]); }                             
		  			else draw(decks[1]); draw(decks[1]); }
			}
			else {document.getElementById('drawer').style.display = 'none';
			
			// Draw for next turn
			if(myturn) { if(!hand.length) draw(decks[0]);
				draw(decks[0]);   }                             
  			else { if(!hand.length) draw(decks[1]);
				draw(decks[1]);   }  

			myturn = !myturn; // myturn used for drawing
   
			let temp=[];
			temp = hand2;
			hand2 = hand;
			hand = temp;

			// swap(hp, hp2);
			let temp2=0;
			temp2 = hp2;
			hp2 = hp;
			hp = temp2;

			playsLeft = 1;
			
			// swap(blocks, blocks2);
			temp2 = blocks2;
			blocks2 = blocks;
			blocks = temp2;
			display();}
		}

		function swap(arg1, arg2) {
			let temp=0;
			temp = arg2;
			arg2 = arg1;
			arg1 = temp;
		}
	</script>
</head>
<body>
<div id="hand" style="position: absolute; left: 20%; top: 20%; width: fit-content;"></div>
<button id="drawer" style="font-size: 72px; position: absolute; left: 40%; top: 80%;" onclick="init();">Draw</button>
<p id="stats" style="border: solid; text-align: center; font-size: 52px; position: absolute; right: 6%; top: 50%;">HP: 10<br>Plays: 1<br>Blocks: 0</p>
<div id="stats2" style="border: solid; text-align: center; font-size: 52px; position: absolute; top: 1%;">OPPONENT<hr>HP: 10<br>Plays: 0<br>Blocks: 0</div>
</body>
</html>