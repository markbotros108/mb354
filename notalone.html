<!DOCTYPE html>
<html> 
<head> 
	<title>Not Alone</title>
	<style type="text/css">
		#hand, #stats, #played, #marker {
			color: blue;
			position: absolute;
			left: 7%;
			top: 60%;
		}

		img {
			padding: 8px;
			cursor: pointer;
			/*width: 18%;*/
		}

		#played{
			border: solid;
			left: 5%;
			width: 90%;
			height: 235px;
			color: black;
			top: 30%;
			font-size: 30px;
		}

		#played img, #marker img {
			cursor: initial;
		}

		#stats, #marker{
			top: 5%;
			font-size: 66px;
		}

		#marker {
			left: 67%;
		}

		#marker img {
			width: 200px;
		}

		#survivalcards {
			padding: 15px;
			text-align: center;
			cursor: pointer;
 			position: absolute;
 			width: 10%;
 			height: 5%;
 			top: 88%;
 			right: 10%;
 			border: solid;
 			opacity: 100%;
		}

		.survCard {
			display: inline-block;
			font-size: 36px;
			position: relative;
			top: 5%;
			cursor: pointer;
			border: solid;
			padding: : 20px;
			/*padding-bottom: 500px;*/
			width: 350px;
			height: 200px;
			margin-left: 50px;
		}
	</style>	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script type="text/javascript">
		// Began 3:30pm 18/1/21
		// Began card #2 function 4:30am 19/1/21
		// Added creature and began card #4 function 5:40am
		// Added card #1 and cont card #4 image 6:15am
		// Added card #5, card #6 and card #8 functions 7:10am
		// Added card #3, card #10 and half of card #9 3:10am 20/1/21
		// As well as card list's togglable size with resize function 
		// TODO 7 (Survival cards)
		const cards = ['lair', 'jungle', 'river', 'beach', 'rover'];
		const reserve = ['swamp', 'shelter', 'wreck', 'source', 'artefact'];
		const survival = ['ADRENALINE', 'VACCINE', 'INGENUITY', 'AMPLIFIER'];
		let hand = [], played = [], survivalList = [], mySurvival = [];
		let will = 3, ass = 0, res = 0, caught = false, marker = false;
		var lurked, prevChosen, creatureMoved, swamped=0, resized = true;
		
		$(document).ready( function(){ init(); }); 

		function init(){
			hand = hand.concat(cards);
			displayHand();
			initialiseSurvivalCards();
			survivalList = shuffle(survivalList);
		}

		function shuffle(list) {
			var newOrder = [];
			var len = list.length;
			for (var i = 0; i < len; i++) { var r = Math.floor(Math.random()*list.length);
				newOrder.push(list[r]);
				list.splice(r, 1);
			}
			return newOrder;
		}

		function displayHand(){ document.getElementById('hand').innerHTML = '';
			if(!hand.length) { lostwill();
				hand = hand.concat(played);
				played = [];
			}
			for (var i = 0; i < hand.length; i++) {
				var newcard = document.createElement('img');
				newcard.src = 'images/' + hand[i] + '.png';
				newcard.onclick = function() {play(this.src);}
				document.getElementById('hand').append(newcard);
			}
		}

		function displayPlayed(){ document.getElementById('played').innerHTML = '';
			for (var i = 0; i < played.length; i++) {
				var newcard = document.createElement('img');
				newcard.src = 'images/' + played[i] + '.png';
				document.getElementById('played').append(newcard);
			}
		}

		function updateDisplay(){displayHand(); displayPlayed();}

		function updateStats(){
			document.getElementById('stats').innerHTML = 'Will: ' +will+ '/3<br> Assimilation: ' +ass+ '/7<br> Rescue: ' + res +'/13';

			if(will<=0) setTimeout(lostwill, 300);
			if(ass>=7) alert("You were assimilated. You lose..");
			if(res>=13) alert("You were rescued! YOU WIN!");
		}

		function lostwill() { ass++; will=3;
			alert("You lost all your will! Assimilation increases...");
			updateStats();
		}

		function play(name){ //let currHtml = this.innerHTML;
			let fixedName = name.slice(name.indexOf('images/')+7, -4);
			console.log('You played '+ fixedName); // 45, -4
			
				// Player moves
				let chosen = hand.splice(hand.indexOf(fixedName), 1);
				played.push(chosen.toString());
	
				// Creature moves
				if(!creatureMoved) moveCreature();
		
				// CHeck for creature caught player
				if(chosen == lurked) { caught = true;
					alert("The creature caught you! Lose 1 Will.");
					will--; 
					if (lurked == 'lair') {will--;
						alert("The creature caught you in its LAIR! Lose 1 EXTRA Will.");
					}
				}
	
				updateStats();
				updateDisplay();
				if(!caught) setTimeout(action, 200);
			// }
			caught = false;
			prevChosen = chosen;
			creatureMoved = false;
		}

		function moveCreature(){ creatureMoved = true;
			var creature = Math.floor(Math.random()*hand.length);
			lurked = hand[creature].toString();
			alert("The creature was in the "+lurked);
		}

		function action(){ let word = played[played.length-1]; var foundCard;
			if(word == "jungle" && played.length>1){ let found = false;
				do {let input = parseInt(prompt('Which number would you like returned to your hand?'));
					if (input==2) alert('Cannot pick 2.');
					else {for (var i = 0; i < played.length; i++) {
								if (played[i] == cards[input-1] || played[i] == reserve[input-6]) {found=true;
									foundCard = played.splice(i, 1);
									played.splice(played.indexOf('jungle'), 1);
								}
							}
							if (!found) alert('Could not find matching played card number ' + input);
						}
				} while (!found)
			
				// Card found. return it to hand along with 2
				if(!hand.includes('jungle')) hand.push('jungle');
				hand.push(foundCard.toString());
				updateDisplay();
			}

			else if (word == "beach"){
				if (marker) { marker = false;
					document.getElementById('marker').innerHTML = '';
					res++;
					updateStats();
				}
				else {marker = true; 
					var newmark = document.createElement('img');
					newmark.src = 'images/pawn.png';
					document.getElementById('marker').append(newmark);
				}
			}

			else if (word == "rover"){ 
				if (reserveLeft()) {var rover =1; // 0 to cancel
					while (rover < 6 || rover > 10 || hand.includes(reserve[rover - 6]) || played.includes(reserve[rover - 6])) rover = parseInt(prompt("Which card number would you like to add?"));
					if(rover != 0) hand.push(reserve[rover - 6].toString());
					displayHand();
				}
			}

			else if(word == "lair"){
				if(confirm("Would you like to copy the power of the creature's location?")){
					alert("Copied power of the "+lurked);
					played.push(lurked);
					action();
					played.pop();
				}
				else {alert("Returning all cards from discard pile."); 
					for (var i = 0; i < played.length-1; i++) {
						hand.push(played[i]);
					}
					played = ['lair'];
					updateDisplay();
				}
			}

			else if(word == 'swamp' && played.length>1){let found = false;
				do {let input = parseInt(prompt('Which number would you like returned to your hand?'));
					if (input==6) alert('Cannot pick 6.');
					else {for (var i = 0; i < played.length; i++) {
								if (played[i] == cards[input-1] || played[i] == reserve[input-6]) {
									found=true;
									foundCard = played.splice(i, 1);
									played.splice(played.indexOf('swamp'), 1);
								}
							}
							if (!found) alert('Could not find matching played card number ' + input);
						}
				} while (!found)
			
				// Card found. return it to hand then play action again
				hand.push(foundCard.toString());
				if(!hand.includes('swamp')) hand.push('swamp');
				updateDisplay();
				swamped++;
				if (swamped%2 == 1) {	
					played.push('swamp');
					action();
					played.pop();}				
			}

			else if(word == 'wreck') {res++; updateStats();}

			else if(word == 'source') {
				if(confirm("Would you like to regain 1 Will?")) {
					if (will<3) { will++; updateStats(); }
				}
				else {alert("Drawing 1 Survival card.");
					mySurvival.push(survivalList.pop());
					document.getElementById('survivalcards').innerHTML = 'SURVIVAL CARDS <br> ('+ mySurvival.length +')';
				}
			}

			else if(word == 'shelter') alert("Drawing 2 Survival cards. Choose one.");

			else if(word == 'river' || word == 'artefact') {
				const cardSelect = document.querySelectorAll('img');
				cardSelect.forEach(card => {
					card.onclick = select;
				})
				document.getElementById('cardList').onclick = resizeCardlist;
			}

			else console.log(word+' card action not implemented');
		}

		function select() {
			this.style.background = 'tomato';
			setTimeout(selectResolve, 300);
		}

		function selectResolve() { 
			const cardSelect = document.getElementById('hand').children;
			let selected = 0, selectArray=[];
			for (var i = 0; i < cardSelect.length; i++) {
				if (cardSelect[i].style.background == 'tomato') {selected++;
					let cardName = cardSelect[i].src;
					selectArray.push(cardName.slice( cardName.indexOf('images/')+7, -4 ));}
			}
			
			if(selected==2) {
				let choice = confirm('Would you like to select ['+selectArray+ '] as your choices for the '+prevChosen +' card?' );
						if(choice) { moveCreature(); //alert('You selected '+selectArray);
							if(prevChosen == "river"){ let chooseOne;
								while(!hand.includes(chooseOne))
								chooseOne = prompt('Which card would you like to play?');
								// hand[hand.indexOf(cards[chooseOne-1])]
								play('images/'+ chooseOne +'.png'); // will not work online
							}
							else if (prevChosen == "artefact") {
								play('images/'+selectArray[0] +'.png');
								creatureMoved = true;
								play('images/'+selectArray[1] +'.png');
							}
						}
		
						const cardSelect = document.querySelectorAll('img');
						cardSelect.forEach(card => {
							if(choice) card.onclick = function() {play(this.src, this);}
							card.style.background = 'initial';
						})
						document.getElementById('cardList').onclick = resizeCardlist;
					}
		}

		function reserveLeft(){ let check=0;
			for (var i = 0; i < reserve.length; i++) {
				if (hand.includes(reserve[i]) || played.includes(reserve[i]))
					check++;
			}
			if(check==5) return false;
			return true;
		}

		function resizeCardlist(elem){ resized = !resized;
			if(resized)	document.getElementById(elem).style.width = '10%';
			else document.getElementById(elem).style.width = '100%';

			if(elem == 'survivalcards' && !resized) {
				survivalWindow = document.getElementById(elem);
				survivalWindow.style.cursor = 'initial';
				survivalWindow.style.width = '80%';
				survivalWindow.style.height = '80%';
				survivalWindow.style.top = "0%";
				survivalWindow.style.backgroundColor = 'aliceblue';
				survivalWindow.innerHTML = '';

				for (var i = 0; i < mySurvival.length; i++) {
					var newSurvCard = document.createElement('span');
					newSurvCard.className = 'survCard';
					newSurvCard.title = mySurvival[i].name;
					newSurvCard.innerHTML = '<u>'+mySurvival[i].name+'</u><br>' + mySurvival[i].desc ;
					newSurvCard.onclick = function() {playSurvival(this.title); };
					survivalWindow.append(newSurvCard);
				}

				if(!mySurvival.length) survivalWindow.innerHTML = 'Click here to minimise Survival Cards.';
			}
			else if(elem == 'survivalcards') {
				survivalWindow = document.getElementById(elem);
				survivalWindow.innerHTML = 'SURVIVAL CARDS <br> ('+ mySurvival.length +')';
				survivalWindow.style.cursor = 'pointer';
				survivalWindow.style.height = '5%';
				survivalWindow.style.top = "88%";
				survivalWindow.style.backgroundColor = 'white';
			}
		}

		function initialiseSurvivalCards() {
			for (var i = 0; i < survival.length; i++) {
				var survObj = {name: survival[i], desc: survivalDescs(i)};
				survivalList.push(survObj);
			}
		}

		function survivalDescs(no) {
			switch(no){
				case 0: return 'Regain 1 Will.';
				case 1: return 'Decrease the Assimilation counter by 1.';
				case 2: return 'Place the Marker counter on the Beach.';
				case 3: return 'Remove the Marker & immediately increase the Rescue counter +1.';
				default: return 'not implemented';
			}
		}

		function playSurvival(name) { console.log('Played survival card: '+ name);
			switch(name){
				case survival[0]: if (will<3) will++; break;
				case survival[1]: if (ass>0) ass--; break;
				case survival[2]: if(!marker) {marker = true; 
								var newmark = document.createElement('img');
								newmark.src = 'images/pawn.png';
								document.getElementById('marker').append(newmark);}
								break;
				case survival[3]: if (marker) { marker = false;
								document.getElementById('marker').innerHTML = '';
								res++;}
								break;
				default: return 'not implemented';
			}

			mySurvival.splice(mySurvival.indexOf(name), 1);
			document.getElementById('survivalcards').innerHTML = 'SURVIVAL CARDS <br> ('+ mySurvival.length +')';
			updateStats();
		}
	</script>
</head>
<body>
<span id="stats">Will: 3/3<br> Assimilation: 0/7<br> Rescue: 0/13</span>
<div id="marker"></div>
<div id="played">Played</div>
<div id="hand"></div>
<img src="images/allcards.png" id="cardList" style="position: absolute; width: 10%; right: -1%;" onclick="resizeCardlist('cardList');">
<p id="survivalcards" onclick="resizeCardlist('survivalcards');">SURVIVAL CARDS</p>
</body>
</html>

<!-- COMPLETED SURVIVAL CARDS:
1. ADRENALINE (Phase 1): Regain 1 Will.
14 VACCINE (Phase 1): Move the Assimilation counter back by 1 space.
9 INGENUITY (Phase 1): Place the Marker counter on the Beach.
2. AMPLIFIER (Phase 4): Remove the Marker counter from the Beach to immediately move the Rescue counter forward	1 space.

5 DOUBLE BACK (Phase 4): Take back the Place card you just played.
11 SIXTH SENSE (Phase 1): Take back to your hand 2 Place cards from your Discard pile.
15 VORTEX (Phase 2): Swap your played Place card for one Place card from your Discard pile.
4 DODGE (Phase 3): Avoid the effects of the Creature token.
6 DRONE (Phase 3): Instead of using the Power of your Place card, copy the Power of the Rover.
7 GATE (Phase 3): Instead of using the Power of your Place card, copy the Power of an adjacent Place.
16 WRONG TRACK (Phase 3): Move the Creature token to an adjacent Place. 
-->
