<!DOCTYPE html>
<html>
<!-- TODO: If two ships with same colour are drawn, discard all harbour -->
<head>
	<title>Port Royal</title>
	<script type="text/javascript">
		let deck = [], playerTurn = 1, playerToggler = true;
		let colours = [ 'blue', 'green', 'yellow', 'red', 'black'];
		var swordFinder = [], coins1 = 0, coins2 = 0;

		class ship {
			constructor(x, y, z) {
				this.coins = x;
				this.colour = y;
				this.swords = z;
			}

			displayShip() {
					let newCard = document.createElement('img');
					newCard.src = 'images/' + this.coins + this.colour + this.swords + '.jpg';
					newCard.style.height = '300px';
					newCard.style.margin = '20px 20px'
					return newCard;
				}
		}

		function start() { document.getElementById('coins').style.display = 'initial';
			document.getElementById('coins2').style.display = 'initial';
			let allButtons = document.getElementsByTagName('button');
			for (var i = allButtons.length - 1; i > 0; i--) {
				allButtons[i].style.display = 'block';
				allButtons[i].style.fontSize = '90px';
				allButtons[i].style.padding = '10px 30px';
				allButtons[i].style.width = '120%';
			}
			allButtons[0].style.display = 'none';
			allButtons[2].style.marginTop = '30px';

			swordCalc();

				let newShip;
			for (var j = 0; j < colours.length; j++) { 
				for (var i = 1; i <= 4; i++) { 
						newShip = new ship(i, colours[j], swordFinder[j][deck.length%10]);
						deck.push(newShip);//console.log(deck[deck.length-1]);

					if (i <= 3)	{ newShip = new ship(i, colours[j], swordFinder[j][deck.length%10]);
						deck.push(newShip);//console.log(deck[deck.length-1]);
						newShip = new ship(i, colours[j], swordFinder[j][deck.length%10]); 
						deck.push(newShip);//console.log(deck[deck.length-1]);
					}
				}
			}
			// deck = shuffle(deck);
		}

		function swordCalc() {
			for (var j = 0; j < colours.length; j++) { let newArr = [];
				for (var i = 0; i < 10; i++) {
					switch(j){ 
						case 0: if (i<4) newArr.push(1);
								else if (i<7) newArr.push(2);
								else newArr.push(5);
								break;
						case 1: if (i<4) newArr.push(1);
								else if (i<7) newArr.push(3);
								else newArr.push(5);
								break;
						case 2: if (i<4) newArr.push(1);
								else if (i<7) newArr.push(2);
								else newArr.push(4);
								break;
						case 3: if (i<3) newArr.push(1);
								else if (i<6) newArr.push(3);
								else if (i<8) newArr.push(6);
								else newArr.push(0);
								break;
						case 4: if (i<3) newArr.push(2);
								else if (i<6) newArr.push(4);
								else if (i<8) newArr.push(7);
								else newArr.push(0);
								break;
					}
				}
				swordFinder.push(newArr);// console.log(swordFinder[swordFinder.length-1]);
			}
		}

		function draw() { document.getElementById('harbour').style.display = 'initial';
			if (deck.length)
			document.getElementById('harbour').append(deck.pop().displayShip());
			else {alert('Deck is empty.');
				document.getElementById('drawer').style.display = 'none';
			}
		}

		function beginTrading() { document.getElementById('drawer').style.display = 'none';
			document.getElementById('ender').innerHTML = 'End turn';
			document.getElementById('ender').onclick = end;
			let currentHarbour = document.getElementsByTagName('img');
			for (var i = 0; i < currentHarbour.length; i++) {
				currentHarbour[i].onclick = trade;
				currentHarbour[i].style.cursor = 'pointer';
			}

		}

		function end(){ 
			alert('Player '+((playerTurn%2)+1)+'\'s turn.');
			playerTurn++; let opponent = document.getElementById('coins2').innerHTML;
			if( playerTurn%2 ) {playerToggler=true; if (opponent.includes('1')) coinSwap();}
			else {playerToggler=false; if (opponent.includes('2')) coinSwap();}

			document.getElementById('harbour').innerHTML = '';
			document.getElementById('harbour').style.display = 'none';
			document.getElementById('drawer').style.display = 'initial';
			document.getElementById('ender').innerHTML = 'Trade';
			document.getElementById('ender').onclick = beginTrading;
		}

		function trade() { let discarded = this.src;
			let chosenShip = discarded.slice(discarded.indexOf('images')+7, discarded.indexOf('.jpg'));
			let cardsDrawn = document.getElementById('harbour');
			for (var i = 0; i < cardsDrawn.children.length; i++) {
				if(cardsDrawn.childNodes[i].src.includes(chosenShip)) {cardsDrawn.removeChild(cardsDrawn.childNodes[i]); break;}
			}
			
			let coinsGained = parseInt(chosenShip[0]);
			if (playerToggler) { coins1 += coinsGained;
				document.getElementById('coins').innerHTML = 'Coins: '+ coins1;
			}
			else {coins2 += coinsGained; document.getElementById('coins').innerHTML = 'Coins: '+ coins2;}
			
			for (var i = 0; i < coinsGained; i++) deck.pop();
			setTimeout(coinSwap, 1000);

			if (!cardsDrawn.children.length) cardsDrawn.style.display = 'none';
			playerToggler = !playerToggler;
		}

		function coinSwap(){
			if(playerToggler) {
				document.getElementById('coins').innerHTML = 'Coins: '+ coins1;
				document.getElementById('coins2').innerHTML = 'Player 2\'s Coins: '+ coins2;
			}
			else {
				document.getElementById('coins').innerHTML = 'Coins: '+ coins2;
				document.getElementById('coins2').innerHTML = 'Player 1\'s Coins: '+ coins1;
			}
		}

		function shuffle(list) {
			var newOrder = [];
			var len = list.length;
			for (var i = 0; i < len; i++) { var r = Math.floor(Math.random()*list.length);
				newOrder.push(list[r]);
				list.splice(r, 1);
			}
			return newOrder;
		}
	</script>
</head>
<body>
<div id="harbour" style="display: none; border: solid; width: 80%; height: auto; position: absolute; left: 10%; top: 20%"></div>
<button onclick="start()" style="position: absolute; top: 70%; left: 45%; font-size: 80px; padding: 13px 40px;">Start</button>
<div id="allButtons" style="display: inline-block; position: absolute; right: 7%; top: 70%;">
	<button id="drawer" onclick="draw()" style="display: none;">Draw</button>
	<button id="ender" onclick="beginTrading()" style="display: none;">Trade</button>
</div>
<div id="coins" style="display: none; font-size: 130px; position: absolute; left: 32%; top: 85%;">Coins: 0</div>
<div id="coins2" style="display: none; font-size: 130px; position: absolute; left: 22%; top: 3%;">Opponent's Coins: 0</div>
</body>
</html>
